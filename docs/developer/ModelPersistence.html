<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=windows-1252">
    <title>Model Persistence</title>
  </head>
  <body>
    <h1>Connecting the SADL IDE with Persistent Storage of OWL Models and Rules</h1>
    <h5>Last revised
      <!--webbot bot="Timestamp" S-Type="EDITED" S-Format="%m/%d/%Y" startspan -->9/24/2021<!--webbot bot="Timestamp" endspan i-checksum="12511" -->.
    </h5>
    <br>
    <h2>Introduction</h2>
    <p>The SADL IDE uses Apache Jena as the interface to in-memory OWL models
      created when a SADL model is processed by the Xtext model processor and as
      the interface to OWL model persistence. The in-memory OWL model, which
      exists as an instance of the Jena <em>org.apache.jena.ontology.OntModel</em>
      class, is persisted when the SADL model from which it was created is
      saved. There are multiple options for how this persistence is
      accomplished. The purpose of this document is to explain the mechanisms
      for both retrieving OWL models from the persistence repository and for
      persisting OWL models to the persistence repository. OWL models must be
      retrieved in various operations such as when inference is run, queries are
      performed, models are graphed, etc.</p>
    <p style="margin-bottom: 0in; line-height: 100%">SADL and SadlServer use the
      Jena <em>org.apache.jena.rdf.model.ModelGetter</em> Java Interface class
      to retrieve OWL models from persistent storage, in the form of in-memory
      Jena <em>org.apache.jena.ref.model.Model</em> and <em>org.apache.jena.ontology.OntModel</em>
      instances. SADL extends this Interface class with the <em>com.ge.research.sadl.model.persistence.ISadlModelGetter</em>
      Interface class, which is in turn extended by the <em>com.ge.research.sadl.model.persistence.ISadlModelGetterPutter</em>
      Interface class, as shown in the figure below. The <em>ISadlModelGetterPutter</em>
      Interface defines methods for persisting OWL models, where as the
      ISadlModelGetter Interface only defines methods for retrieving OWL models
      from the persistent store.</p>
    <div style="margin-left: 40px;"><img src="images/ModelGetterPutterTypeHierarchy.png"
        alt=""></div>
    <p>The <em>ISadlModelGetter</em> is implemented by the abstract <em>com.ge.research.sadl.model.persistence.SadlModelGetter</em>
      class. This class has an extension for each basic type of persistence,
      e.g., file-based persistence and Jena TDB persistence, that provide the
      actual implementations of the methods to retrieve OWL models from the
      persistent store. Each of these implementations are also extended by
      classes that implement the <em>com.ge.research.sadl.model.persistence.ISadlModelGetterPutter</em>
      Interface and provide implementations for saving OWL models to the
      persistent store.</p>
    <p>These classes work in conjunction with the <em>com.ge.research.sadl.model.persistence.SadlPersistenceFormat
        </em>class, which identifies the various persistence formats supported
      and provides convenience methods for validating formats, converting from
      the SADL identifier to those used by Jena in the case of file-based
      persistence, etc.</p>
    <h2>Adding a New Persistence Format to SADL</h2>
    <p>To add a new persistence format to SADL, do the following.</p>
    <ol>
      <li>Add the format to the SadlPersistenceFormat class.</li>
      <ul>
        <li>Add a public static final String that identifies the format</li>
        <li>Add to the class methods as needed, e.g., to validate the format</li>
      </ul>
      <li>Create an getter for the new format by extending the <em>SadlModelGetter</em>
        class, as do the <em>SadJenaFileGetter</em> and the <em>SadlJenaTDBGetter</em>
        classes.</li>
      <li>Create a putter for the new format that extends the new format's
        getter class and implements the <em>ISadlModelGetterPutter</em>
        Interface class, as do the <em>SadlJenaFileGetterPutter</em> and the <em>SadlJenaTDBGetterPutter</em>
        classes.</li>
    </ol>
    <h2>Overview of Classes Involved in SADL and External OWL Model Persistence</h2>
    Apache Jena includes the Java interface class <em>org.apache.jena.rdf.model.ModelGetter
      </em>to retrieve models from the persistence repository. The class
    documentation states, "A ModelGetter object can retrieve a Model given a URL
    for it. If it doesn't have such a Model, it returns null." The extensions
    and implementations of this class used by SADL are described above.<br>
    <p>Jena also uses the class <em>org.apache.jena.ontology.OntModelSpec</em>,
      which "Encapsulates a description of the components of an ontology model,
      including the storage scheme, reasoner and language profile." This class
      encapsulates a field of type <em>OntDocumentManager</em>, in the same
      package, which "Provides services for managing ontology documents,
      including loading imported documents, and locally caching documents from
      resolvable URL's to improve load performance." The <em>OntModelSpec</em>
      class also includes the methods <em>getBaseModelMaker</em>, <em>getImportModelMaker,
        </em>and<em> setImportModelGetter</em>. </p>
    <p>SADL uses an implementation of the class <em>com.ge.research.sadl.reasoner.IConfigurationManager</em>
      or one of its extensions, <em>com.ge.research.sadl.reasoner.IConfigurationManagerForEditing</em>
      or <em>com.ge.research.sadl.builder.IConfigurationManagerForIDE</em>, to
      manage the SADL configuration, including the relevant <em>OntModelSpec</em>
      and <em>OntDocumentManager</em> instances. When the SADL IDE processes a
      SADL model in the <em>com.ge.research.sadl.jena.JenaBasedSadlModelProcesso</em>r
      <em>onValidate</em> method, it retrieves the instance of <em>IConfigurationManagerForIDE</em>
      for the Xtext resource (the current SADL file), from which it retrieves an
      instance of <em>OntModelSpec</em> and <em>OntDocumentManager</em>. It
      then calls the <em>OntModelSpec</em>'s method <em>setImportModelGetter</em>
      with an instance of the class <em>SadlJenaModelGetterPutter</em>. Then,
      before starting to process the SADL file parse tree to construct the
      corresponding OWL <em>OntModel</em>, it calls <em>org.apache.jena.rdf.modelModelFactory's
        createOntologyModel</em> method, passing in the <em>OntModelSpec</em>
      instance, to create an empty <em>OntModel</em>. This in-memory <em>OntModel</em>
      is populated as the SADL file parse tree is processed. When an import
      statement is encountered (and for the implicitly imported models), a call
      is made to get the imported model's <em>OntModel</em> from the <em>com.ge.research.sadl.processing.OntModelProvider</em>
      class. If the imported model's <em>OntModel</em> is not found, then the
      imported model is loaded. If the imported model is another SADL model,
      then it is processed by the <em>JenaBasedSadlModelProcessor</em> and an <em>OntModel</em>
      is created and stored in the <em>OntModelProvider</em>. If the imported
      model is an <em>ExternalEmfResource</em> (an OWL model not derived from a
      SADL model), then the OntModel is generated from the OWL model, which is
      processed to identify the ontological concepts found therein, and stored.
      This method of loading is necessary so that Xtext will have all of the
      information for hyperlinking referenced concepts to their definitions and
      concept definitions to their references. In the case of an <em>ExternalEmfResource</em>,
      the SADL IDE loads an OWL model from an OWL model from persistent storage.
      In the case of a modified SADL model which is saved, the in-memory <em>OntModel</em>
      is saved to the persistence repository as an OWL model using the <em>ISadlModelGetterPutter</em>
      set in the <em>OntModelSpec</em> instance. </p>
    <p>This process works differently when, for example, a request is made to
      graph the models in a SADL project or when running inference not in the
      SADL IDE. In this case the in-memory <em>OntModel</em> instances
      necessary to create the graph(s) or do inference are loaded directly
      from&nbsp; the persistence repository using the <em>ISadlModelGetter</em>.
      Import statements encountered in the <em>OntModel</em>'s triples result
      in additional OWL models being loaded using the instance of <em>SadlJenaModelGetterPutter</em>
      stored in the <em>OntModelSpec</em>. In other words, when Jena loads an
      OWL model from the persistence repository, again using the instance of <em>SadlJenaModelGetterPutter</em>
      in the <em>OntModelSpec</em>, Jena will also load all of the model's
      imports in the same way.</p>
    <br>
  </body>
</html>
